<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime viewer</title>
    <meta name="description" content="One of the most complicated yet amazing web design that have ever created, enjoy anime anytime, anywhere, with amazing quality.">
    <meta name="keywords" content="red sus, red sus's, Red Sus, Red Sus's, red sus web, red sus's web, Red Sus web, Red Sus's web, red sus website, red sus's website, Red Sus website, Red Sus's website, portfolio">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            cursor: none;
        }
        #mediaContainer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #mediaPlayer, #mediaImage {
            position: absolute;
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }
        #mediaPlayer {
            background-color: black;
        }
        #loadingIndicator {
            position: absolute;
            font-family: sans-serif;
            color: white;
            font-size: 2em;
            display: none;
        }
    </style>
</head>
<body>
    <div id="mediaContainer">
        <video id="mediaPlayer" autoplay muted playsinline></video>
        <img id="mediaImage" alt="Ad Banner">
        <div id="loadingIndicator">Loading...</div>
    </div>

    <script>
        class RobustMediaPlayer {
            constructor() {
                this.mediaPlayer = document.getElementById('mediaPlayer');
                this.mediaImage = document.getElementById('mediaImage');
                this.loadingIndicator = document.getElementById('loadingIndicator');
                this.mediaFiles = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.isInitialized = false;
                this.imageTimer = null;
                this.playAttemptInterval = null;
                this.healthCheckInterval = null;
                this.memoryCleanupInterval = null;
                this.connectionCheckInterval = null;
                this.preloadedMedia = new Map();
                this.PRELOAD_COUNT = 2;
                this.MAX_PRELOAD_ITEMS = 5;
                this.consecutiveErrors = 0;
                this.MAX_CONSECUTIVE_ERRORS = 5;
                this.errorLog = [];
                this.MAX_ERROR_LOG = 50;
                this.IMAGE_DURATION = 10000;
                this.VIDEO_TIMEOUT = 15000;
                this.HEALTH_CHECK_INTERVAL = 30000;
                this.MEMORY_CLEANUP_INTERVAL = 300000;
                this.CONNECTION_CHECK_INTERVAL = 60000;
                this.lastActivityTime = Date.now();
                this.mediaLoadTimes = [];
                this.MAX_LOAD_TIME_SAMPLES = 10;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.startHealthMonitoring();
                this.startMemoryManagement();
                this.startConnectionMonitoring();
                this.setupVisibilityHandling();
                this.setupErrorRecovery();
            }

            setupEventListeners() {
                this.mediaPlayer.addEventListener('ended', () => this.handleVideoEnd());
                this.mediaPlayer.addEventListener('error', (e) => this.handleMediaError(e));
                this.mediaPlayer.addEventListener('loadeddata', () => this.handleVideoLoaded());
                this.mediaPlayer.addEventListener('canplay', () => this.handleVideoCanPlay());
                this.mediaPlayer.addEventListener('stalled', () => this.handleVideoStalled());
                this.mediaPlayer.addEventListener('waiting', () => this.handleVideoWaiting());
                window.addEventListener('online', () => this.handleNetworkReconnect());
                window.addEventListener('offline', () => this.handleNetworkDisconnect());
                window.addEventListener('beforeunload', () => this.cleanup());
                document.addEventListener('click', () => this.requestFullscreen());
                document.addEventListener('keydown', () => this.requestFullscreen());
            }

            setupMedia(files) {
                this.mediaFiles = files.filter(file => file && file.trim() && this.isValidUrl(file));
                if (this.mediaFiles.length === 0) {
                    this.logError('No valid media files provided');
                    return false;
                }
                this.consecutiveErrors = 0;
                this.isInitialized = true;
                this.preloadNextMedia();
                this.playNextMedia();
                return true;
            }

            isValidUrl(url) {
                try {
                    new URL(url);
                    return true;
                } catch {
                    return false;
                }
            }

            preloadNextMedia() {
                if (this.preloadedMedia.size > this.MAX_PRELOAD_ITEMS) {
                    this.cleanupOldPreloadedMedia();
                }
                for (let i = 1; i <= this.PRELOAD_COUNT && i < this.mediaFiles.length; i++) {
                    const nextIndex = (this.currentIndex + i) % this.mediaFiles.length;
                    const file = this.mediaFiles[nextIndex];
                    if (this.preloadedMedia.has(nextIndex)) {
                        continue;
                    }
                    const fileExtension = this.getFileExtension(file);
                    const startTime = Date.now();
                    if (this.isVideoFile(fileExtension)) {
                        this.preloadVideo(file, nextIndex, startTime);
                    } else if (this.isImageFile(fileExtension)) {
                        this.preloadImage(file, nextIndex, startTime);
                    }
                }
            }

            preloadVideo(file, index, startTime) {
                const video = document.createElement('video');
                video.src = file;
                video.preload = 'metadata';
                video.muted = true;
                video.playsInline = true;
                video.style.display = 'none';
                video.addEventListener('loadedmetadata', () => {
                    this.recordLoadTime(startTime);
                });
                video.addEventListener('error', () => {
                    this.handlePreloadError(file, index);
                });
                document.body.appendChild(video);
                this.preloadedMedia.set(index, {
                    element: video,
                    type: 'video',
                    loadTime: startTime,
                    file: file
                });
            }

            preloadImage(file, index, startTime) {
                const img = new Image();
                img.src = file;
                img.style.display = 'none';
                img.addEventListener('load', () => {
                    this.recordLoadTime(startTime);
                });
                img.addEventListener('error', () => {
                    this.handlePreloadError(file, index);
                });
                document.body.appendChild(img);
                this.preloadedMedia.set(index, {
                    element: img,
                    type: 'image',
                    loadTime: startTime,
                    file: file
                });
            }

            cleanupOldPreloadedMedia() {
                const currentTime = Date.now();
                const oldItems = [];
                this.preloadedMedia.forEach((item, index) => {
                    const indexDistance = Math.abs(index - this.currentIndex);
                    const isOld = currentTime - item.loadTime > 300000;
                    const isTooFar = indexDistance > this.PRELOAD_COUNT + 2;
                    if (isOld || isTooFar) {
                        oldItems.push(index);
                    }
                });
                oldItems.forEach(index => {
                    const item = this.preloadedMedia.get(index);
                    if (item && item.element && item.element.parentNode) {
                        item.element.parentNode.removeChild(item.element);
                    }
                    this.preloadedMedia.delete(index);
                });
            }

            recordLoadTime(startTime) {
                const loadTime = Date.now() - startTime;
                this.mediaLoadTimes.push(loadTime);
                if (this.mediaLoadTimes.length > this.MAX_LOAD_TIME_SAMPLES) {
                    this.mediaLoadTimes.shift();
                }
            }

            getAverageLoadTime() {
                if (this.mediaLoadTimes.length === 0) return 0;
                const sum = this.mediaLoadTimes.reduce((a, b) => a + b, 0);
                return sum / this.mediaLoadTimes.length;
            }

            handlePreloadError(file, index) {
                this.logError(`Preload failed for: ${file}`);
                this.preloadedMedia.delete(index);
            }

            playNextMedia() {
                this.clearAllTimers();
                this.isPlaying = false;
                this.lastActivityTime = Date.now();
                this.hideLoadingIndicator();
                if (!this.isInitialized || this.mediaFiles.length === 0) {
                    this.logError('Cannot play: not initialized or no media files');
                    return;
                }
                if (this.consecutiveErrors >= this.MAX_CONSECUTIVE_ERRORS) {
                    this.handleCriticalError();
                    return;
                }
                const file = this.mediaFiles[this.currentIndex];
                if (!file) {
                    this.nextMedia();
                    return;
                }
                const fileExtension = this.getFileExtension(file);
                this.mediaPlayer.style.opacity = '0';
                this.mediaImage.style.opacity = '0';
                this.showLoadingIndicator();
                setTimeout(() => {
                    if (this.isVideoFile(fileExtension)) {
                        this.playVideo(file);
                    } else if (this.isImageFile(fileExtension)) {
                        this.playImage(file);
                    } else {
                        this.logError(`Unsupported file type: ${fileExtension}`);
                        this.nextMedia();
                    }
                }, 500);
            }

            playVideo(file) {
                this.mediaPlayer.pause();
                this.mediaPlayer.src = '';
                this.mediaPlayer.load();
                this.mediaPlayer.style.display = 'block';
                this.mediaImage.style.display = 'none';
                this.mediaPlayer.src = file;
                const loadTimeout = setTimeout(() => {
                    if (!this.isPlaying) {
                        this.logError(`Video load timeout: ${file}`);
                        this.handleMediaError();
                    }
                }, this.VIDEO_TIMEOUT);
                const playAttempt = () => {
                    if (this.mediaPlayer.readyState >= 2) {
                        clearTimeout(loadTimeout);
                        this.mediaPlayer.play()
                            .then(() => {
                                this.isPlaying = true;
                                this.consecutiveErrors = 0;
                                this.mediaPlayer.style.opacity = '1';
                                this.hideLoadingIndicator();
                            })
                            .catch(error => {
                                this.logError(`Video play failed: ${error.message}`);
                                this.handleMediaError();
                            });
                    } else {
                        setTimeout(playAttempt, 100);
                    }
                };
                this.mediaPlayer.load();
                setTimeout(playAttempt, 100);
                this.preloadNextMedia();
            }

            playImage(file) {
                this.mediaImage.src = file;
                this.mediaImage.style.display = 'block';
                this.mediaPlayer.style.display = 'none';
                this.mediaPlayer.pause();
                const imageLoadTimeout = setTimeout(() => {
                    this.logError(`Image load timeout: ${file}`);
                    this.handleMediaError();
                }, 5000);
                this.mediaImage.onload = () => {
                    clearTimeout(imageLoadTimeout);
                    this.mediaImage.style.opacity = '1';
                    this.consecutiveErrors = 0;
                    this.hideLoadingIndicator();
                    this.imageTimer = setTimeout(() => {
                        this.nextMedia();
                    }, this.IMAGE_DURATION);
                };
                this.mediaImage.onerror = () => {
                    clearTimeout(imageLoadTimeout);
                    this.logError(`Image load failed: ${file}`);
                    this.handleMediaError();
                };
                this.preloadNextMedia();
            }

            handleVideoEnd() {
                this.nextMedia();
            }

            handleVideoLoaded() {
            }

            handleVideoCanPlay() {
            }

            handleVideoStalled() {
                this.logError('Video stalled');
                setTimeout(() => {
                    if (!this.isPlaying) {
                        this.handleMediaError();
                    }
                }, 5000);
            }

            handleVideoWaiting() {
            }

            handleMediaError(event = null) {
                this.consecutiveErrors++;
                this.isPlaying = false;
                const errorMsg = event ? `Media error: ${event.message || 'Unknown error'}` : 'Media playback failed';
                this.logError(errorMsg);
                if (this.consecutiveErrors < this.MAX_CONSECUTIVE_ERRORS) {
                    setTimeout(() => this.nextMedia(), 1000);
                } else {
                    this.handleCriticalError();
                }
            }

            handleCriticalError() {
                this.logError('Critical error: resetting player');
                this.consecutiveErrors = 0;
                this.currentIndex = 0;
                this.cleanup();
                setTimeout(() => {
                    this.preloadNextMedia();
                    this.playNextMedia();
                }, 5000);
            }

            handleNetworkDisconnect() {
                this.logError('Network disconnected');
                this.mediaPlayer.pause();
                this.showLoadingIndicator('Network disconnected...');
            }

            handleNetworkReconnect() {
                this.hideLoadingIndicator();
                if (!this.isPlaying && this.isInitialized) {
                    setTimeout(() => {
                        this.preloadNextMedia();
                        this.playNextMedia();
                    }, 1000);
                }
            }

            startHealthMonitoring() {
                this.healthCheckInterval = setInterval(() => {
                    this.performHealthCheck();
                }, this.HEALTH_CHECK_INTERVAL);
            }

            performHealthCheck() {
                const now = Date.now();
                const timeSinceLastActivity = now - this.lastActivityTime;
                if (timeSinceLastActivity > this.HEALTH_CHECK_INTERVAL * 2) {
                    this.nextMedia();
                }
            }

            startMemoryManagement() {
                this.memoryCleanupInterval = setInterval(() => {
                    this.performMemoryCleanup();
                }, this.MEMORY_CLEANUP_INTERVAL);
            }

            performMemoryCleanup() {
                this.cleanupOldPreloadedMedia();
                if (this.errorLog.length > this.MAX_ERROR_LOG) {
                    this.errorLog = this.errorLog.slice(-this.MAX_ERROR_LOG / 2);
                }
                if (window.gc && typeof window.gc === 'function') {
                    window.gc();
                }
            }

            startConnectionMonitoring() {
                this.connectionCheckInterval = setInterval(() => {
                    this.checkConnection();
                }, this.CONNECTION_CHECK_INTERVAL);
            }

            checkConnection() {
                if (!navigator.onLine) {
                    this.handleNetworkDisconnect();
                    return;
                }
                if (this.mediaFiles.length > 0) {
                    fetch(this.mediaFiles[0], { method: 'HEAD', mode: 'no-cors' })
                        .catch(() => {
                            this.logError('Connection test failed');
                            this.showLoadingIndicator('Connection issues...');
                        });
                }
            }

            setupVisibilityHandling() {
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.mediaPlayer.pause();
                    } else {
                        if (this.isInitialized && !this.isPlaying) {
                            setTimeout(() => this.playNextMedia(), 500);
                        }
                    }
                });
            }

            setupErrorRecovery() {
                window.addEventListener('error', (event) => {
                    this.logError(`Global error: ${event.message}`);
                });
                window.addEventListener('unhandledrejection', (event) => {
                    this.logError(`Unhandled promise rejection: ${event.reason}`);
                });
            }

            nextMedia() {
                this.currentIndex = (this.currentIndex + 1) % this.mediaFiles.length;
                this.playNextMedia();
            }

            getFileExtension(file) {
                return file.split('.').pop().toLowerCase().split('?')[0];
            }

            isVideoFile(extension) {
                return ['mp4', 'webm', 'ogg', 'mov', 'avi', 'm4v'].includes(extension);
            }

            isImageFile(extension) {
                return ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp'].includes(extension);
            }

            requestFullscreen() {
                if (document.fullscreenElement) return;
                const elem = document.documentElement;
                const requestFS = elem.requestFullscreen ||
                                  elem.webkitRequestFullscreen ||
                                  elem.msRequestFullscreen;
                if (requestFS) {
                    requestFS.call(elem).catch(err => {
                    });
                }
            }

            showLoadingIndicator(message = 'Loading...') {
                this.loadingIndicator.textContent = message;
                this.loadingIndicator.style.display = 'block';
            }

            hideLoadingIndicator() {
                this.loadingIndicator.style.display = 'none';
            }

            clearAllTimers() {
                if (this.imageTimer) {
                    clearTimeout(this.imageTimer);
                    this.imageTimer = null;
                }
                if (this.playAttemptInterval) {
                    clearInterval(this.playAttemptInterval);
                    this.playAttemptInterval = null;
                }
            }

            cleanup() {
                this.clearAllTimers();
                if (this.healthCheckInterval) {
                    clearInterval(this.healthCheckInterval);
                    this.healthCheckInterval = null;
                }
                if (this.memoryCleanupInterval) {
                    clearInterval(this.memoryCleanupInterval);
                    this.memoryCleanupInterval = null;
                }
                if (this.connectionCheckInterval) {
                    clearInterval(this.connectionCheckInterval);
                    this.connectionCheckInterval = null;
                }
                this.preloadedMedia.forEach(item => {
                    if (item.element && item.element.parentNode) {
                        item.element.parentNode.removeChild(item.element);
                    }
                });
                this.preloadedMedia.clear();
                this.mediaPlayer.pause();
                this.mediaPlayer.src = '';
                this.hideLoadingIndicator();
            }

            logError(message) {
                const timestamp = new Date().toISOString();
                const logEntry = `[${timestamp}] ${message}`;
                this.errorLog.push(logEntry);
                if (this.errorLog.length > this.MAX_ERROR_LOG) {
                    this.errorLog.shift();
                }
                console.error(logEntry);
            }

            getStatus() {
                return {
                    isPlaying: this.isPlaying,
                    currentIndex: this.currentIndex,
                    totalFiles: this.mediaFiles.length,
                    consecutiveErrors: this.consecutiveErrors,
                    preloadedCount: this.preloadedMedia.size,
                    averageLoadTime: this.getAverageLoadTime(),
                    errorCount: this.errorLog.length,
                    lastActivity: new Date(this.lastActivityTime).toISOString(),
                    errorLog: this.errorLog
                };
            }

            restart() {
                this.cleanup();
                this.consecutiveErrors = 0;
                this.currentIndex = 0;
                setTimeout(() => {
                    this.preloadNextMedia();
                    this.playNextMedia();
                }, 1000);
            }
        }

        let mediaPlayer;

        document.addEventListener('DOMContentLoaded', () => {
            mediaPlayer = new RobustMediaPlayer();
            const success = mediaPlayer.setupMedia([
                'https://rare-gallery.com/livewalls/videostmp/74e1b2b16c84b17ac856d7785b12a5d8.mp4',
                'https://rare-gallery.com/uploads/posts/305736-Anime-Girl-Swimsuit-4K.jpg',
                'https://rare-gallery.com/livewalls/videostmp/ffd4b6cffa007420cc8dfed6f5ea514a.mp4',
                'https://rare-gallery.com/livewalls/videostmp/1db279c067bdeecf5bac076123a27c22.mp4',
                'https://rare-gallery.com/livewalls/videostmp/fae9cb53dcd6d29234be1b45210103f2.mp4',
                'https://rare-gallery.com/uploads/posts/303609-Azur-Lane-Kaga-Anime-Girl-Beach-Swimsuit-Bikini-4K.jpg',
                'https://rare-gallery.com/mocahbig/418912-anime-girls-Amashiro-Natsuki-artwork-animal-ears.jpg',
                'https://rare-gallery.com/livewalls/videostmp/7405fd317bd9aa52e60b177c37ba9092.mp4',
                'https://rare-gallery.com/livewalls/videostmp/65199d17abbdee3ba0b01e730dc6e967.mp4',
                'https://rare-gallery.com/livewalls/videostmp/cf2895842e2bf887397d5dbf5832c7ad.mp4',
                'https://rare-gallery.com/livewalls/videostmp/377b4b91acfc2f0b7a6f11980c29fa15.mp4',
                'https://rare-gallery.com/livewalls/videostmp/3cf88cd9af4d2f6dd3021b5953857d39.mp4',
                'https://rare-gallery.com/uploads/posts/4516192-short-hair-white-hair-white-background-aqua-eyes-bed-blushing-hair-bows-eromanga-sensei-izumi-sagiri-loli-shorts.jpg',
                'https://rare-gallery.com/livewalls/videostmp/10238d4bab573ed83c7054dc1cff7949.mp4',
                'https://rare-gallery.com/livewalls/videostmp/e0145b8e1e971ee6eef6882fe163ea29.mp4',
                'https://rare-gallery.com/livewalls/videostmp/6bb6c152d23864b9d5aec51a6fee479a.mp4'
            ]);
            if (!success) {
            }
            window.getPlayerStatus = () => {
                const status = mediaPlayer.getStatus();
                console.log('Player Status:', status);
                return status;
            };
            window.restartPlayer = () => {
                mediaPlayer.restart();
            };
        });

        window.addEventListener('error', (event) => {
            if (mediaPlayer) {
                mediaPlayer.logError(`Global error: ${event.error?.message || 'Unknown error'}`);
            }
            if (event.error && event.error.message.includes('out of memory')) {
                setTimeout(() => {
                    location.reload();
                }, 5000);
            }
        });
    </script>
</body>
</html>
